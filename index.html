<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Print Calculator</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>

<style>
body{font-family:Arial;background:#f4f6f8}
.box{max-width:380px;margin:30px auto;background:#fff;padding:20px;border-radius:10px}
button{width:100%;padding:10px;margin:10px 0;background:#007bff;color:#fff;border:none;border-radius:5px}
.whatsapp{background:#25D366}
img{display:block;margin:10px auto}
</style>
</head>

<body>

<div class="box">
<h3>Print Price Calculator</h3>

<input type="file" id="file" accept=".pdf,image/*" onchange="countPages()">
<select id="spiral">
<option value="no">Spiral - No</option>
<option value="yes">Spiral - Yes (+₹30)</option>
</select>

<button onclick="calculate()">Calculate</button>

<div id="out" style="display:none;text-align:center">
<p>Pages: <span id="p"></span></p>
<p>Spiral: <span id="s"></span></p>
<p><b>Total: ₹<span id="t"></span></b></p>
<img id="qr" width="180">
<button class="whatsapp" onclick="sendWhatsApp()">Send Message + QR</button>
</div>
</div>

<canvas id="canvas" width="300" height="420" style="display:none"></canvas>

<script>
let pages=0, price=0, spiral="";

function countPages(){
 let f=file.files[0];
 if(!f) return;
 if(f.type.startsWith("image/")) pages=1;
 else{
  let r=new FileReader();
  r.onload=e=>{
   pdfjsLib.getDocument(new Uint8Array(e.target.result)).promise.then(p=>pages=p.numPages);
  };
  r.readAsArrayBuffer(f);
 }
}

function calculate(){
 if(pages==0){alert("Upload file");return;}
 spiral = spiralSelect = spiral.value=="yes"?"Yes":"No";
 price = pages*4 + (spiral=="Yes"?30:0);

 p.innerText=pages;
 s.innerText=spiral;
 t.innerText=price;

 let upi=`upi://pay?pa=adityadhali@fam&pn=Print&am=${price}&cu=INR`;
 qr.src=`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(upi)}`;
 out.style.display="block";
}

function sendWhatsApp(){
 let c=canvas,ctx=c.getContext("2d");
 ctx.fillStyle="#fff";ctx.fillRect(0,0,300,420);
 ctx.fillStyle="#000";ctx.font="16px Arial";
 ctx.fillText("Print Order Details",70,30);
 ctx.fillText("Pages: "+pages,20,70);
 ctx.fillText("Spiral: "+spiral,20,100);
 ctx.fillText("Total: ₹"+price,20,130);

 let img=new Image(); img.crossOrigin="anonymous"; img.src=qr.src;
 img.onload=()=>{
  ctx.drawImage(img,50,160,200,200);
  c.toBlob(b=>{
   let file=new File([b],"order.png",{type:"image/png"});
   navigator.share({
    files:[file],
    text:`Your order details:\nPages: ${pages}\nSpiral: ${spiral}\nTotal Amount: ₹${price}\nPlease pay via QR and send screenshot.`
   });
  });
 }
}
</script>

</body>
</html>
